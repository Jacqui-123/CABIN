
# CABIN Data Exploration

Preliminary wrangling, tidying and exploration for benthic data within all regions sampled in Canada within the Canadian Aquatic Biomonitoring Network (CABIN). 

CABIN is an aquatic biomonitoring program for freshwater ecosystems that began in 1987. Sites are divided in to "Reference" , or "Test" sites.

Reference sites represent sites without industrial, agriculture, or development activity. Test sites may or may not have similar activity, and data from the reference sites is used to assess changes to macroinvertebrate communities, water chemistry, and habitat. 

Here, we graphically explore the differences between test and reference sites to see if a) we can detect a difference in pH, macroinvertebrate abundance, and percent sorted between test and reference sites.

```{r, echo = FALSE, include = FALSE}
library(png)
library(dplyr)
library(tidyverse)
library(reticulate)
library(zoo)
library(lubridate)
library(ggplot2)
library(sf)
library(mapview)
library(gridExtra)
library(data.table)
library(scales) 
library(sqldf)
library(hexbin)
```

### 1) Load in the data
Benthic CABIN data in one dataframe, with a column of region
```{r}
library(data.table)
files <- list.files(path = "/Users/LevyJ/Desktop/CABIN", pattern = "^cabin_benthic.*?\\.csv", full.names = TRUE) 
df_benthic <- map_df(files, ~read_csv(., col_types = cols(.default = "c")), .id = "Region", encoding = 'Latin-1') 
```

-Load in Study (meta) CABIN data in one dataframe, with a column of the region.
This has the lat/long coordinates (code not shown, see above)
```{r, echo = FALSE, include = FALSE}
library(data.table)
files <- list.files(path = "/Users/LevyJ/Desktop/CABIN", pattern = "^cabin_study.*?\\.csv", full.names = TRUE) 
df_study <- map_df(files, ~read_csv(., col_types = cols(.default = "c")), .id = "Region", encoding = 'Latin-1') 
```

-Load in the Habitat data, with a column for each region. (code not shown, see above)
```{r, echo = FALSE, include = FALSE}
library(data.table)
files <- list.files(path = "/Users/LevyJ/Desktop/CABIN", pattern = "^cabin_habitat.*?\\.csv", full.names = TRUE) 
df_habitat <- map_df(files, ~read_csv(., col_types = cols(.default = "c")), .id = "Region", encoding = 'Latin-1') 
```

### 2) Data Tidying 
a\) Benthic Data

-Rename the columns to be easier to work with. (code not shown)
```{r, echo = FALSE, include = FALSE}
df_benthic <- df_benthic %>%
  rename("Site_Visit_ID" = 'SiteVisitID/IdentifiantdeVisite',
         "Site" = "Site/Site",
         "Year" = "Year/Année",
         "Sampling_Device" = "SamplingDevice/Dispositifd'échantillonnage",
         "Kick_Time" = "KickTime/Périodedelapassedufilettroubleau",
         "Mesh_size" = "MeshSize/Maillage",
         "Subsample" =	"SubSample/Sous-échantillon",
         "Julian_day" ="JulianDay/JourJulien",
         "Total_sample" ="TotalSample/Échantillontotal",
         "Status" = "Status/État",
         "Taxonomist" = "Taxonomist/Taxonomiste",
         "organization" = "Organization/Organisation",
         "address" = "Address/Adresser",
         "city" = "City/Ville",
         "province" = "Province/Province",
         "phylum" = "Phylum/Phylum",
         "class" = "Class/Classe",
         "Order" = "Order/Ordre",
         "Family" = "Family/Famille",
         "Genus" = "Genus/Genre",
         "Species" = "Species/Espèce",
         "Replicate" = "Replicate/Réplicat",
         "Count" = "Count/Décompte",
         "ITIS" ="ITIS_TSN",
         "Valid" = "Valid/Valide")
```

-Mutate a new column "unique ID" with the site visit ID, site, and year separated by a "-". This is so we have a unique id for each site visit and year.
```{r}
df_benthic <- df_benthic %>%
  tidyr::unite("Unique_Id", c("Site_Visit_ID", "Site", "Year" ), sep = "_", remove = TRUE ) 
```

-Select only kick net samples, sample # = 1, mesh size 400, and calculate the total abundance for each unique site. Individual taxa are removed for now. 
```{r}
#change count column to numeric data
df_benthic$Count = as.numeric(as.character(df_benthic$Count) )
df_benthic$Count <- round (df_benthic$Count, digits = 0)

df_benthic <- df_benthic %>%
 filter( Sampling_Device == 'Kick Net') %>%
  filter(Mesh_size == "400") %>%
   filter(Sample_Number == '1') %>%
  group_by(Unique_Id) %>%
  mutate("Abundance" = sum(Count) ) %>%
  #removing the individual taxa for now, just using total abundance
  select(Region, Unique_Id, Julian_day, Sampling_Device, Kick_Time, Mesh_size, Sample_Number, Subsample, Total_sample, Status, Abundance) %>%
  distinct()

```

-Load in the region names and add to the benthic data using the region names file (file made in excel)
```{r, echo = FALSE, include = FALSE}
Region_names <- read.csv("Region_names.csv", colClasses =c("character", "character", "character")) 
df_benthic <- full_join(df_benthic, Region_names, by = 'Region') 

#remove file name column
df_benthic <-df_benthic %>%
  select(-c('File_Name', 'Region'))

rm(Region_names)
```

b\) Study data tidying:

-(Study data columns were renamed in excel)

-Mutate a new column "unique ID" with the site visit ID, site, and year separated by a "-" (code not shown, see above)

-Keep only the River site, as some are lake or wetland sites - taking a conservative approach here

```{r, echo = FALSE, include = FALSE}

df_study <- df_study %>%
   #some sites have type = lake or wetland, we want to remove these
  filter(Type == 'River') %>%
  tidyr::unite("Unique_Id", c("SiteVisitID", "Site", "Year"), sep =  "_", remove = TRUE) 

```

c\) Habitat data tidying:

-Rename to make the habitat data easier to work with. (code not shown)
Unit, year, sample_number were renamed in excel. 
```{r, echo=FALSE, include=FALSE}

colnames(df_habitat )
df_habitat <- df_habitat %>%
  rename("Site_Visit_Id" = 'SiteVisitID/IdentifiantdeVisite',
         "Site" = "Site/Site",
         "Julian_day" = "JulianDay/JourJulian",
         "Status" ="Status/État",
         "Stat_Num" = "status",
         "Type" = "Type/Type",
         "Value" = "Value/Valeur",
         "Computed" = "Computed/Calculé",
         "Notes" = "Note/Remarque" ) %>%
  mutate(Status = replace(Status, Stat_Num == "1", "Reference" ),
         Status = replace(Status, Stat_Num =="2", "Test"),
         Status = replace(Status, Stat_Num == "3", "Potential Reference")) %>%
  dplyr::select(Region, Site_Visit_Id, Site, Protocol, Julian_day, Year, Sample_Number, Status, Stat_Num, QAQC, Type, Variable, VariableDescription, Unit, Value, MDL, Computed, Notes)
```

-Mutate a new column "unique ID" with the site visit ID, site, and year separated by a "-" (code not shown, see above)

-removed the 65 NAs for Protocol and Site - these are where the previous line from MDL/notes/computed continued on the next line and entered "<0.0005 mg/L" etc for site. Deleted these, but might be missing some data for these sites - 

*NOTE: ask Wendy to look at habitat data region #5 spreadsheet**
```{r, echo= FALSE, include=FALSE}

df_habitat <-df_habitat %>%
  drop_na(Protocol)  %>%
tidyr::unite("Unique_Id", c("Site_Visit_Id", "Site", "Year" ), sep = "_", remove = TRUE )

```

-Pivot habitat data so environmental/habitat variables are in columns, values in rows to enable joining to study and benthic datasets.

**Note: MDL, notes, and computed are not included, because they represent multiple observations per row.**

```{r}

df_habitat <- df_habitat %>%
  #keep only first sample from triplicates
  filter(Sample_Number == "1") %>%
  #get rid of protocols other than wadeable streams
  filter(Protocol == "CABIN - Wadeable Streams") %>% 
  #ignore computed, mdl, and notes for now
  select(-c("VariableDescription", "Notes", "Computed", "MDL")) %>%
  tidyr::unite("Habitat Variable", c("Type", "Variable", "Unit"), sep = "_") %>%
  pivot_wider(names_from = "Habitat Variable", values_from = "Value") 

#sum(is.na(df_habitat$Status))

#sum(is.na(df_benthic$Status))

#df_both[is.na(df_both$Status),]

```

-Sanity checkpoint- make sure the lengths of each new id column are the same as the length of each data frame - they add up (code not shown)
```{r, echo = FALSE, include=FALSE}

length(unique(df_benthic$Unique_Id)) #7056
length(unique(df_study$Unique_Id)) #9264
length(unique(df_habitat$Unique_Id)) #7744

```
### 3) Merge data together

-Change df to Data.tables for quicker processing speed using the data.table vignette (code not shown)
```{r, echo = FALSE, include = FALSE}
setDT(df_benthic)
setDT(df_study)
setDT(df_habitat)
```

-Join the three data tables together, using the habitat data as a base, because we only want to keep benthic data with the "CABIN - Wadeable Streams" protocol.

```{r, echo = FALSE}

df_habitat <- df_habitat %>%
  select(-c("Sample_Number", "Region", "Julian_day"))

df_benthic <- df_benthic %>%
  select(-c("Status"))

#merge habitat and benthic data, keeping only the sites in the habitat data set
df_both <- merge(df_habitat, df_benthic, by= "Unique_Id", all.x = TRUE)

#merge benthic data, keeping only the sites in the hab/benth dataset.
df_all <- merge(df_both, df_study, by = "Unique_Id", all.x =TRUE)

#check:
#length(unique(df_all$Unique_Id)) # should be same length as df, n=7744

rm(df_both)

```

Sanity check after merging - count number of test, potential test, and reference sites there are. These should add to 7744 (they do!)
```{r, echo = FALSE, include=FALSE}
length(unique(df_all$Unique_Id)) #7744

num_ref_sites <- sqldf( "select Status, Unique_Id
                     from df_all Where Status Like '%Refere%' ") #3720


num_test_sites <- sqldf("select Status, Unique_Id
                         from df_all where Status LIKE 'Test' ") #4024

#3720 + 4024 = 7744

colSums(is.na(df_all)) #No Nas for "Status"

rm(num_ref_sites, num_test_sites)
```


### 4) Get ready to graph 

Tidy and reformat df_all pH data (code not shown)
```{r, echo = FALSE, include = FALSE}
df_all <-  df_all %>% 
  rename("Water_Chemistry_pH" = "Water Chemistry_General-pH_pH",
         "Water_Chemistry_Alkalinity" = "Water Chemistry_General-Alkalinity_mg/L")


df_all$Water_Chemistry_pH = as.numeric(as.character(df_all$Water_Chemistry_pH) )
df_all$Water_Chemistry_pH <- round(df_all$Water_Chemistry_pH, digit = 3)

df_all$Water_Chemistry_Alkalinity = as.numeric(as.character(df_all$Water_Chemistry_Alkalinity) )
df_all$Water_Chemistry_Alkalinity <- round(df_all$Water_Chemistry_Alkalinity, digit = 4)

```

Graphing prep: make separate data.table for test, reference, and all sites for quicker processing
```{r}
df_ref <- df_all %>%
  #changing na's this way doesn't work- likely they are listed implicitly (go back and do this when load in data or address individually)
 replace_na(list(Status = "Unknown", Subsample = "Unknown")) %>% 
  filter(Status == "Reference" | Status == "Potential Reference") %>%
  select(Unique_Id, Region_Name, Protocol, Status, Abundance, Subsample, Water_Chemistry_pH, Water_Chemistry_Alkalinity ) %>%
  #filter(str_detect(Unique_Id_Sample, "_1$")) %>%
  mutate_at(c('Subsample'), as.numeric) %>%
  distinct()

df_test <- df_all %>%
#changing na's this way doesn't work- likely they are listed implicitly (go back and do this when load in data or address individually)  replace_na(list(Status = "Unknown", Subsample = "Unknown")) %>% 
  filter(Status == "Test" ) %>%
  select(Unique_Id, Region_Name, Protocol, Status, Abundance, Subsample, Water_Chemistry_pH, Water_Chemistry_Alkalinity ) %>%
  #filter(str_detect(Unique_Id_Sample, "_1$")) %>%
  mutate_at(c('Subsample'), as.numeric) %>%
  distinct()

df_status <- df_all %>% 
#changing na's this way doesn't work- likely they are listed implicitly (go back and do this when load in data or address individually)  replace_na(list(Status = "Unknown", Subsample = "Unknown")) %>% 
  filter(Status == "Test" | Status == "Reference" | Status == "Potential Reference") %>%
  select(Unique_Id, Region_Name, Protocol, Status, Abundance, Subsample, Water_Chemistry_pH ) %>%
  #filter(str_detect(Unique_Id_Sample, "_1$")) %>%
  mutate_at(c("Water_Chemistry_pH"), as.numeric) %>%
  mutate_at(c('Subsample'), as.numeric) %>%
  distinct()

```

### 5) Graphing: Percent Sorted by reference and test sites

```{r, echo=FALSE, fig.align='center'}
#ref sites
cbPalette <- c("#999999","#CC79A7" , "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#332288", "#D55E00", "#44AA99")

ggplot(df_ref, aes(x = Region_Name, y = Subsample, fill = Region_Name )) +
geom_boxplot() +
  theme_bw() +
  geom_point() +
    theme(plot.title =  element_text(size = 10, hjust = .5, face = "bold")) +
       #  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
   stat_boxplot(geom = "errorbar", width = 0.25) +
  ggtitle( "Percent Sorted by Region \n(Potential Reference or Reference Sites) ") +
  theme(legend.position = 'none') +
scale_x_discrete(labels = wrap_format(10)) +
  ylab("Percent Sorted") +
    scale_fill_manual(values=cbPalette) 
```

```{r, echo=FALSE, fig.align='center'}
#c) Test sites
df_test %>% 
  filter(Subsample <= 100) %>%
  ggplot( aes(x = Region_Name, y = Subsample, fill = Region_Name )) +
geom_boxplot() +
    geom_point() +
  theme_bw() +
    theme(plot.title =  element_text(size = 10, hjust = .5, face = "bold")) +
       #  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
   stat_boxplot(geom = "errorbar", width = 0.25) +
  ggtitle( "Percent Sorted by Region \n(Test Sites) ") +
  theme(legend.position = 'none') +
    #theme(legend.background = element_rect(colour = 'black', fill = 'white', linetype='solid')) +
scale_x_discrete(labels = wrap_format(10)) +
  ylab("Percent Sorted") +
    scale_fill_manual(values=cbPalette)

```

Table with # of data points for each region (ref/potential ref sites):

  **Note: double check why the Arctic Region is left out- likely there were not points present     under the wadeable stream protocol**

```{r,echo=FALSE}
 dplyr::count(df_ref, Region_Name, sort = TRUE) %>%
  mutate(sum(n))

#Arctic Region isn't included ...?
```
Table with # of data points for each region (test sites) 

  **Note: double check why the Arctic Region is left out- likely it wasn't under the wadeable         stream protocol**
```{r, echo = FALSE}
 dplyr::count(df_test, Region_Name, sort = TRUE) %>%
  mutate(sum(n))
```

### 6) Graphing: Total Abundance (macroinvertebrate count) data

**Note: looks like there may be outliers? These are not excluded from the scatterplots below**
```{r, echo = FALSE, fig.align='center'}
#a) boxplots, reference sites

df_ref %>% 
  filter(Subsample <= 100) %>%
  ggplot( aes(x = Region_Name, y = Abundance, fill = Region_Name )) +
geom_boxplot() +
    geom_point() +
  theme_bw() +
    theme(plot.title =  element_text(size = 10, hjust = .5, face = "bold")) +
       #  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
   stat_boxplot(geom = "errorbar", width = 0.25) +
  ggtitle( "Percent Sorted and Abundance by Region \n(Reference Sites) ") +
  theme(legend.position = 'none') +
    #theme(legend.background = element_rect(colour = 'black', fill = 'white', linetype='solid')) +
scale_x_discrete(labels = wrap_format(10)) +
  ylab("Total Abundance (count)") +
    scale_fill_manual(values=cbPalette)

```

```{r, echo = FALSE, fig.align='center'}
#b) boxplots, test sites

df_test %>% 
  filter(Subsample <= 100) %>%
  ggplot( aes(x = Region_Name, y = Abundance, fill = Region_Name )) +
geom_boxplot() +
    geom_point() +
  theme_bw() +
    theme(plot.title =  element_text(size = 10, hjust = .5, face = "bold")) +
       #  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
   stat_boxplot(geom = "errorbar", width = 0.25) +
  ggtitle( "Percent Sorted and and Abundance by Region \n(Test Sites) ") +
  theme(legend.position = 'none') +
scale_x_discrete(labels = wrap_format(10)) +
  ylab("Total Abundance (count)") +
    scale_fill_manual(values=cbPalette)
```


```{r, fig.width = 6, fig.height= 6,    echo = FALSE, fig.align='center'}
#c) Scatterplots: Abundance vs percent sorted, by region - Reference sites
#(y=300 dotted line)
df_ref %>%
  filter(Subsample <= 100) %>%
ggplot(mapping = aes(x = Subsample, y = Abundance, colour = Region_Name) ) +
  geom_point(size=2) + 
  geom_hline(yintercept = 300, linetype = "dotted") +
facet_wrap(~Region_Name, labeller = labeller(Region_Name = label_wrap_gen(width = 25))) +
      theme_bw() +
  scale_colour_manual(values = c("#999999","#CC79A7" , "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#332288", "#D55E00", "#44AA99")) +
 theme(plot.title =  element_text(size = 10, hjust = .5, face = "bold")) +
  ggtitle( "Percent Sorted vs Abundance \n (Reference/Potential Reference Sites) ") +
 ylab("Total Abundance (count) ") +
 xlab("Percent Sorted") + 
  theme(legend.position= 'none')

```


```{r, fig.width = 6, fig.height= 6,    echo = FALSE, fig.align='center'}
#d) Scatterplots: Abundance vs percent sorted, by region - Test sites
#(y=300 dotted line)
df_test %>%
  filter(Subsample <= 100) %>%
ggplot(mapping = aes(x = Subsample, y = Abundance, colour = Region_Name) ) +
  geom_point(size=2) + 
  geom_hline(yintercept = 300, linetype = "dotted") +
facet_wrap(~Region_Name) +
  facet_wrap(~Region_Name, labeller = labeller(Region_Name = label_wrap_gen(width = 25))) +
      theme_bw() +
  scale_colour_manual(values = c("#999999","#CC79A7" , "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#332288", "#D55E00", "#44AA99")) +
 theme(plot.title =  element_text(size = 10, hjust = .5, face = "bold")) +
  ggtitle( "Percent Sorted vs Abundance \n (Test Sites) ") +
 ylab("Total Abundance (count) ") +
 xlab("Percent Sorted") + 
  theme(legend.position= 'none')
```


```{r,    echo = FALSE, fig.width = 5, fig.height= 5, fig.align='center'}
#e) Scatterplot: Abundance vs percent sorted,for all regions together
#(dotted line at y = 300)
df_status %>%
  filter(Subsample <= 100) %>%
  mutate(Status = replace(Status, Status == "Potential Reference", "Reference" )) %>%
ggplot(mapping = aes(x = Subsample, y = Abundance, colour = Status) ) +
  geom_point(size=3, alpha = 0.3) + 
  geom_hline(yintercept = 300, linetype = "dotted") +
facet_wrap(~Status) +
      theme_bw() +
  scale_colour_manual(values = c("#999999","#CC79A7" , "#E69F00" )) +
 theme(plot.title =  element_text(size = 10, hjust = .5, face = "bold")) +
  ggtitle( "Percent Sorted vs Abundance \n (Test & Reference/Potential Reference Sites) ") +
 ylab("Total Abundance (count) ") +
 xlab("Percent Sorted") +
  theme(legend.position= 'none') 

```

### 7) Graphing: pH data (& Percent sorted)

**Note: ask what to do about the lower values, are all of these pH values valid?**

```{r,    echo = FALSE, fig.align='center'}
#a) Boxplots: Reference sites

df_ref %>% 
  filter(Subsample <= 100) %>%
  na.omit() %>%
  ggplot( aes(x = Region_Name, y = Water_Chemistry_pH, fill = Region_Name )) +
geom_boxplot() +
    geom_point() +
  theme_bw() +
    theme(plot.title =  element_text(size = 10, hjust = .5, face = "bold")) +
       #  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
   stat_boxplot(geom = "errorbar", width = 0.25) +
  ggtitle( "pH by Region \n(Reference and Potential Refernce Sites) ") +
  theme(legend.position = 'none') +
scale_x_discrete(labels = wrap_format(10)) +
  ylab("pH") +
    scale_fill_manual(values=cbPalette)

```


```{r,    echo = FALSE, fig.align='center'}
#b) Boxplots: Test sites
#(outlier pH = 14 removed, no others removed)

df_test %>% 
  filter(Subsample <= 100) %>%
  filter(Water_Chemistry_pH <= 14) %>%
  na.omit() %>%
  ggplot( aes(x = Region_Name, y = Water_Chemistry_pH, fill = Region_Name )) +
geom_boxplot() +
    geom_point() +
  theme_bw() +
    theme(plot.title =  element_text(size = 10, hjust = .5, face = "bold")) +
       #  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
   stat_boxplot(geom = "errorbar", width = 0.25) +
  ggtitle( "pH by Region \n(Test Sites) ") +
  theme(legend.position = 'none') +
scale_x_discrete(labels = wrap_format(10)) +
  ylab("pH") +
    scale_fill_manual(values=cbPalette)
```


```{r, fig.width = 6, fig.height= 6,   echo = FALSE, fig.align='center'}

#c) Scatterplots: pH vs percent sorted 
#Reference sites
#(Outliers have not been removed)
df_ref %>%
filter(Subsample <= 100) %>%
    na.omit() %>%
ggplot(mapping = aes(x = Water_Chemistry_pH, y = Subsample, colour = Region_Name )) +
  geom_point(size=2) +
  facet_wrap(~Region_Name, labeller = labeller(Region_Name = label_wrap_gen(width = 25))) +
 theme_bw() +
    theme(plot.title =  element_text(size = 10, hjust = .5, face = "bold")) +
  ggtitle( "pH vs Percent Sorted \n (Reference or Potential Reference Sites) ") +
 ylab("Percent Sorted") +
 xlab("pH") +
scale_color_manual(values= cbPalette) +
theme(legend.position = "None") 

```


```{r, fig.width = 6, fig.height= 6,   echo = FALSE, fig.align='center'}
#d) Scatterplots: Percent sorted vs pH  
#Test sites
#(Outliers have not been removed)
df_test %>%
filter(Subsample <= 100) %>%
    filter(Water_Chemistry_pH <= 14) %>%
    na.omit() %>%
ggplot(mapping = aes(x = Water_Chemistry_pH, y = Subsample, colour = Region_Name )) +
  geom_point(size=2) +
  facet_wrap(~Region_Name, labeller = labeller(Region_Name = label_wrap_gen(width = 25))) +
 theme_bw() +
    theme(plot.title =  element_text(size = 10, hjust = .5, face = "bold")) +
  ggtitle( "pH vs Percent Sorted \n (Test Sites) ") +
 ylab("Percent Sorted") +
 xlab("pH") +
scale_color_manual(values= cbPalette) +
theme(legend.position = "None") 
```


```{r,   echo = FALSE, fig.width = 5, fig.height= 5, fig.align='center'}
#e) Scatterplot: Percent sorted vs pH  -- all regions
#(Outliers >= pH 14 removed but no others removed)

df_status %>%
  filter(Subsample <= 100) %>%
    filter(Water_Chemistry_pH <= 14) %>%
  mutate(Status = replace(Status, Status == "Potential Reference", "Reference" )) %>%
ggplot(mapping = aes(x = Water_Chemistry_pH, y = Subsample, colour = Status) ) +
  geom_point(size=3, alpha = 0.3) + 
facet_wrap(~Status) +
      theme_bw() +
  scale_colour_manual(values = c( "#009E73", "#0072B2" )) +
 theme(plot.title =  element_text(size = 10, hjust = .5, face = "bold")) +
  ggtitle( "pH vs Percent Sorted \n (Test and Refer. Sites for all regions) ") +
 ylab("Percent Sorted ") +
 xlab("pH") +
  theme(legend.position= 'none') 

```

### 8) Graphing: pH data (& Abundance)
```{r, fig.width = 6, fig.height= 6,   echo = FALSE, fig.align='center'}
#a) Reference sites 

df_ref %>%
filter(Subsample <= 100) %>%
    na.omit() %>%
ggplot(mapping = aes(x = Water_Chemistry_pH, y = Abundance, colour = Region_Name )) +
  geom_point(size=2) +
  facet_wrap(~Region_Name, labeller = labeller(Region_Name = label_wrap_gen(width = 25))) +
 theme_bw() +
    theme(plot.title =  element_text(size = 10, hjust = .5, face = "bold")) +
  ggtitle( "pH vs Abundance \n (Reference or Potential Reference Sites) ") +
 ylab("Abundance") +
 xlab("pH") +
scale_color_manual(values= cbPalette) +
theme(legend.position = "None") 

```

```{r, fig.width = 6, fig.height= 6,   echo = FALSE, fig.align='center'}
#b)Test Sites

df_test %>%
filter(Subsample <= 100) %>%
    na.omit() %>%
      filter(Water_Chemistry_pH <= 14) %>%
ggplot(mapping = aes(x = Water_Chemistry_pH, y = Abundance, colour = Region_Name )) +
  geom_point(size=2) +
  facet_wrap(~Region_Name, labeller = labeller(Region_Name = label_wrap_gen(width = 25))) +
 theme_bw() +
    theme(plot.title =  element_text(size = 10, hjust = .5, face = "bold")) +
  ggtitle( "pH vs Abundance \n (Test Sites) ") +
 ylab("Abundance") +
 xlab("pH") +
scale_color_manual(values= cbPalette) +
theme(legend.position = "None") 

```

```{r,   echo = FALSE, fig.width = 5, fig.height= 5, fig.align='center'}
#C) pH vs Abundance, all regions

df_status %>%
  filter(Subsample <= 100) %>%
    filter(Water_Chemistry_pH <= 14) %>%
  mutate(Status = replace(Status, Status == "Potential Reference", "Reference" )) %>%
ggplot(mapping = aes(x = Water_Chemistry_pH, y = Abundance, colour = Status) ) +
  geom_point(size=3, alpha = 0.3) + 
facet_wrap(~Status) +
      theme_bw() +
  scale_colour_manual(values = c( "#CC79A7", "#44AA99" )) +
 theme(plot.title =  element_text(size = 10, hjust = .5, face = "bold")) +
  ggtitle( "pH vs Abundance \n (Test and Refer. Sites for all regions) ") +
 ylab("Abundance ") +
 xlab("pH") +
  theme(legend.position= 'none') 

```



